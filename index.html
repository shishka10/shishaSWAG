<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Telegram Login Widget Example</title>
    <script async src="https://telegram.org/js/telegram-widget.js?15"
            data-telegram-login="jojossaslol_bot"
            data-size="large"
            data-userpic="false"
            data-auth-url=""
            data-request-access="write"
            data-userpic="false"
            data-callback="onTelegramAuth">
    </script>
</head>
<body>
<h2>Вход через Telegram</h2>
<div id="result"></div>
<script>
    console.log('121231')
    async function onTelegramAuth(user) {
        // user содержит данные из Telegram Login Widget
        const formData = new FormData();
        formData.append('id', user.id);
        formData.append('first_name', user.first_name || "");
        formData.append('username', user.username || "");
        formData.append('auth_date', user.auth_date);
        formData.append('hash', user.hash);
        let joj = document.getElementById('result');
        joj.insertAdjacentHTML('afterbegin',`<p>${user.id}</p>`);
        try {

            const response = await fetch('http://localhost:8000/auth/token', {
                method: 'POST',
                body: formData
            });
            if (!response.ok) throw new Error('Ошибка авторизации');
            const data = await response.json();
            document.getElementById('result').innerText = 'JWT токен: ' + data.access_token;
            // Сохраняйте токен и используйте для аутентифицированных запросов
        } catch (err) {
            document.getElementById('result').innerText = 'Ошибка: ' + err.message;
        }
    }
</script>
</body>
</html>
